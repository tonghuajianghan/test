<%@page import="com.itextpdf.text.log.SysoLogger"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8" import="cn.cust.kyc.vo.*,java.util.*,java.text.SimpleDateFormat"%>

<%@taglib uri="/struts-tags" prefix="s" %>

<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://"
			+ request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<base href="<%=basePath%>">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Insert title here</title>

<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="This is my page">
<script type="text/javascript" src="js/mydate.js"></script>
<script type='text/javascript' src='js/project/autoComplete2.js'></script>
<link rel="stylesheet" type="text/css" href="css/mydate.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<script type="text/javascript">
var textObj;
var serialNumberFlag;
function createXMLHttp() {
	if (typeof XMLHttpRequest != "undefined") {
		return new XMLHttpRequest();
	} else {
		if (window.ActiveXObject) {
			var aVersions = ["MSXML2.XMLHttp.5.0", "MSXML2.XMLHttp.4.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp", "Microsoft.XMLHttp"];
			for (var i = 0; i < aVersions.length; i++) {
				try {
					return new ActiveXObject(aVersions[i]);
				}
				catch (e) {
					alert("对不起，浏览器发送请求出错！");
				}
			}
		}
	}
}
function getCode(obj, type){
	textObj = obj;
	var xmlHttp = createXMLHttp();
	xmlHttp.open("post","mCode.action?method=getCodes",true);
	xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	xmlHttp.send("codeType="+type);
	xmlHttp.onreadystatechange=function(){
		if(xmlHttp.readyState==4){
			if(xmlHttp.status==200){
				var content = document.getElementById("codeList");
				content.innerHTML = xmlHttp.responseText;
			}
		}
	};
	document.getElementById("codeList").style.display="block";
	document.getElementById("cover").style.display="block";
}
function checkSerialNumber(){
	var f = document.getElementById("theForm");
	var serialNumber=f.serialNumber.value;
	var innerCode=f.innerCode.value;
	var xmlHttp = createXMLHttp();
	xmlHttp.open("post","mPerson.action?method=checkSerialNumber",true);
	xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	xmlHttp.send("serialNumber="+serialNumber+"&innerCode="+innerCode);
	xmlHttp.onreadystatechange=function(){
		if(xmlHttp.readyState==4){
			if(xmlHttp.status==200){
				var infoBack = xmlHttp.responseText;
				if(infoBack==0){
					serialNumberFlag=0;
				}else if(infoBack==1){
					alert("成员序号不能重复");
					serialNumberFlag=1;
				}else{
					serialNumberFlag=1;
				}
			}
		}
	};
}
function hide(){
	document.getElementById("cover").style.display = "none";
	document.getElementById("codeList").style.display = "none";
}
function setCode(){
	var sv = document.getElementById("scode").value;
	var st = document.getElementById("newCode").value.replace(/(^\s*)|(\s*$)/g, "");
	var code;
	if(st!=""&&sv!=""){
		if(confirm("使用新增代码？"))
			code = st;
		else
			code = sv;
	}else{
		code = st + sv;
		if(code==""){
			alert("请选择或填入代码！");
			document.getElementById("newCode").value = "";
			return;
		}
	}
	textObj.value = code;
	hide();
}
function addCode(){
	var s = document.getElementById("scode");
	var i = s.selectedIndex;
	if(i >= 0)
             s.options[i].selected = false;
}
function checkIt(){
	var f = document.getElementById("theForm");
	if(f.name.value.length==0){
		alert("请填写姓名！");
		return false;
	}else if(f.serialNumber.value==""){//
		alert("请填写序号！");
		return false;
	}else if(!f.serialNumber.value.match("^[0-9]{1,}$")){//
		alert("序号应是数字！");
		return false;
	}else if(serialNumberFlag!=0){//
		alert("序号不能重复！");
		return false;
	}else if(f.enterDate.value==""){//
		alert("请填写登记日期！");
		return false;
	}else if(f.memberId.value == null || f.memberId.value.length == 0){
		alert("请填写已登记的姓名！");
		return false;
	}else if(f.role.value==""){
		alert("请填写成员身份！");
		return false;
	}else if(f.idCardNo.value==""){
		alert("请填写身份证号！");
		return false;
	}else if(f.payCode.value==""){
		alert("请填写工资代号！");
		return false;
	}else if(f.idCardNo.value.length > 18){
		alert("请输入正确的身份证号！");
		return false;
	}else if(isNaN(f.workload.value)){
		alert("工作量应为数字！");
		return false;
	}else if(f.workload.value > <%=request.getAttribute("restWorkload")%>){
		alert('工作量不能大于：<%=request.getAttribute("restWorkload")%>元');
		return false;
	}
	return true;
}

function getMember(){
	window.open("mMember.action?method=getMembers","memberFrame");
	document.getElementById("showMembers").style.display="block";
	document.getElementById("cover").style.display="block";
}

function cancelMember(){
	document.getElementById("showMembers").style.display="none";
	document.getElementById("cover").style.display="none";
}
</script>
</head>
<style type="text/css">
table {
	margin: 20px 0px 0 100px;
}

.showTheCodes {
	display: none;
	width: 100%;
	height: 100%;
	position: absolute;
	top: 0px :     left :     0px;
	background-color: #FFF;
	filter: alpha(opacity =     85);
	opacity: 0.7;
	z-index: 65532;
}

#scode {
	width: 250px;
}

.hideTheDiv {
	display: none;
}

#showMembers {
	display: none;
	position: absolute;
	width: 720px;
	height: 470px;
	border: 2px outset white;
	margin-top: 40px;
	margin-left: 70px;
	padding: 0;
	z-index: 65533;
}

.project td {
	padding: 0px;
	font-size: 5px;
}

#acListShow {
	position: absolute;
	float: left;
	display: none;
	width: 300px;
	z-index: 1;
	cursor: default;
}

#ac_completeBox {
	width: 500px;
	border: 1px solid green;
	border-top: 0px solid green;
	background-color: white;
	margin-top: 0px;
	left: -183px;
	position: relative;
}

#ac_completeBox tr td {
	text-align: left;
}
</style>
<body onload="ac_set_areaid('name', 'acListShow', 'memberId', true)">
<%
	Teacher teacher = (Teacher) request.getSession().getAttribute(
			"teacher");
	if (teacher == null) {
		System.out.println(teacher.getName());
		request.setAttribute("info", "您未登录，或登录已超时，请重新登录！");
%><jsp:forward page="../../info.jsp"></jsp:forward>
<%
	}
	Project p = (Project) request.getAttribute("project");
%>
<% Person ps = (Person) request.getAttribute("person");%>
<div id="cover" class="showTheCodes"></div>
<div id="codeList"></div>
<div id="showMembers"><iframe scrolling="auto" id="memberFrame"
	name="memberFrame" frameborder="0" width="100%" height="100%"></iframe></div>
<form id="theForm" action="mAddPerson.action?method=addPerson"
	method="post" onsubmit="return checkIt();"
	onreset="return confirm('您确定要清空表单吗？');">
<table border="1" cellpadding="0" cellspacing="0" class="tableAdd">
	<tr>
		<th colspan="6" class="head">成员登记<input type="hidden"
			name="memberId" /></th>
	</tr>
	<tr style="display:none">
		<td>项目内部编号</td>
		<td><input name="innerCode" value="<%=p.getInnerCode()%>"
			readonly="readonly" class="readOnly" /></td>
		<td>项目组长</td>
		<td><input name="proLeader" readonly="readonly"
			value="<%=p.getProLeader()%>" class="readOnly" /></td>
	</tr>
	<tr >
		<td>项目名称</td>
		<td ><input size="40" name="proName"
			value="<%=p.getProName()%>" readonly="readonly"
			class="readOnly" /></td>
	</tr>
	<tr style="display:none">
		<td>登记表年度</td>
		<td><input name="year" value="<%=new Date().getYear() + 1900%>"
			readonly="readonly" class="readOnly" /></td>
		<td>登记日期</td>
		<td>
		<%
			Date date = new Date();
			SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
			String strDate = sdf.format(date);
		%>
		<div ><input name="enterDate" readonly="readonly" value="<%=strDate%>"  onclick="HS_setDate(this.parentNode.firstChild);"/>
		<!-- <input type="button" value="T"  onclick="HS_setDate(this.parentNode.firstChild);"/> -->
		</div>
		<font style="float: right; margin-top: -20px;" color="red">*</font></td>
	</tr>
	<tr>
		<td>排名</td>
		<td><input autocomplete="off" name="serialNumber" onblur="checkSerialNumber()"/><font color="red">*</font></td>

	</tr>
	<tr>
		<td>姓名</td>
		<td><%--<input onclick="getMember();" name="name" readonly style="cursor:none;padding-right:20px;background-image:url(img/choose.jpg);background-repeat:no-repeat;background-position:right bottom;"/> --%>
		<input autocomplete="off" onkeyup="ac_getAutoComplete(this)" name="name" />
		<!-- style="padding-right: 20px; background-repeat: no-repeat; background-position: right bottom;" -->
		<font color="red">*</font><br />
		<span id="acListShow"></span></td>
		
	</tr>
	<tr>
		<td>研究分工</td>
		<td ><input  name="assignment" value="<%=ps.getName() %>" /></td>
	</tr>
	<tr style="display:none">
		<td>性别</td>
		<td><input id="sexmale" type="radio" value="男" name="sex" />男&nbsp;&nbsp;<input
			id="sexfemale" type="radio" name="sex" value="女" />女</td>
		<td>出生日期</td>
		<td>
		<div><input style="border: 1px border white;" name="birth" /></div>
		</td>
	</tr>
	<tr style="display:none">
		<td>身份证号</td>
		<td>&nbsp;&nbsp;<input type="text" id="idCardNo" name="idCardNo" /><font
			color="red">*</font></td>
		<td>工资代号</td>
		<td>&nbsp;&nbsp;<input type="text" id="payCode" name="payCode" /><font
			color="red">*</font></td>
	</tr>
	<tr style="display:none">
		<td>学历</td>
		<td>
		<div><input name="diploma" style="border: 1px border white;" /></div>
		</td>
		<td>职称</td>
		<td>
		<div><input name="professionalTitle"
			style="border: 1px border white;" /></div>
		</td>
	</tr>
	<tr style="display:none">
		<td>身份</td>
		<td>
		<div onclick="getCode(this.firstChild, '身份');">
		&nbsp;<input name="role" value="成员" readonly="readonly" />
		<!-- <input type="button" value="..." /> -->
			</div>
		<font style="float: right; margin-top: -20px;" color="red">*</font></td>
		<td>学位</td>
		<td>
		<div><input name="degree" style="border: 1px border white;" /></div>
		</td>
	</tr>
	<tr >
		<td>所属单位</td>
		<td >
		<div style="display: inline;" onclick="getCode(this.firstChild, '单位名称');">
		<input size="40" name="organization" style="border: 1px border white;"  />
		<!-- <input type="button" value="..." /> -->
		</div>
		</td>
	</tr>
	
	<tr style="display:none">
		<td>经手人</td>
		<td><input readonly class="readOnly"
			value="<%=((Teacher) request.getSession().getAttribute("teacher"))
					.getName()%>" /></td>
		<td>修改人</td>
		<td><input readonly class="readOnly" value="" /></td>
	</tr>
	<tr style="display:none">
		<td>注：</td>
		<td colspan="3"><input style="width: 100%" type="text"
			value="灰色处无须填写" readonly="readonly" class="readOnly"></td>
	</tr>
	<tr>
		<td colspan="6"><input type="submit" value="确定提交" />&nbsp;&nbsp;&nbsp;&nbsp;<input
			type="reset" value="清空重填" />&nbsp;&nbsp;&nbsp;&nbsp;<input
			type="button" onclick="history.back();" value="返回上一页" /></td>
	</tr>
</table>
<s:token/>
</form>
</body>
</html>