<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"
	import="java.util.*,cn.cust.kyc.vo.*,cn.cust.kyc.util.*"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://"
			+ request.getServerName() + ":" + request.getServerPort()
			+ path + "/";
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<base href="<%=basePath%>">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Insert title here</title>

<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="This is my page">
<link rel="stylesheet" type="text/css" href="css/style.css">
<script type="text/javascript" src="js/project/ManageProjects.js"></script>
</head>
<style type="text/css">
<!--
.hideTheDiv {
	display: none;
}
ul{
	width:200px;
	height:200px;
	overflow-y: scroll;
	background-color:white;
	margin:0px;
}
ul li{
	list-style-type:none;
	cursor:hand;
}
#control table tr td{
	text-align:left;
}
.save_style{
	margin-left:50px;
	cursor:hand;
}
-->
</style>
<%
List<Patent> list = (List<Patent>) request.getAttribute("patents");
List<FieldBean> fList = FieldsControl.getProjectFields("Patent");
Pagination pagination = (Pagination) request.getAttribute("pagination");
int size = pagination.getSize();
int currentPage = pagination.getPage();
int resultCount = pagination.getResultCount();
int pageCount = pagination.getPageCount();
String pagiUrl = (String) request.getAttribute("pagiUrl");
String year = (String) request.getAttribute("year");
%>
<script type="text/javascript">
<%
String info = (String) request.getAttribute("info");
if(info!=null)
	out.println("alert('"+ info +"');");
%>
function window.onload(){
	
	buildTable();  //初始化表格
	
	init();
	drag = document.createElement("DIV");
	drag.innerHTML      = "";
	drag.style.textAlign="center";
	drag.style.backgroundImage = "url(img/thead.gif)";
	drag.style.fontWeight = "bold";
	drag.style.position = "absolute";
	drag.style.cursor 	= "hand";
	drag.style.border 	= "1px solid black";
	drag.style.display 	= "none";
	drag.style.zIndex 	= "999";
	drag.style.fontSize = "14px";
	document.body.insertBefore(drag);
}
function deleteIt(){
	if(cur_row==null){
		alert("请选择专利项目！");
		return;
	}
	if(!confirm("您确定要删除所选专利项目吗？"))
		return;
	var nbbh = PowerTable.rows[cur_row].cells[0].innerText;
	window.location.href = "mPatent.action?method=deletePatent&ID="+nbbh;
}
function updateIt(){
	if(cur_row==null){
		alert("请选择专利项目！");
		return;
	}
	var nbbh = PowerTable.rows[cur_row].cells[0].innerText;
	window.location.href = "mPatent.action?method=updatePatentIndex&ID="+nbbh;
}
function showIt(){
	if(cur_row==null){
		alert("请选择专利项目！");
		return;
	}
	var nbbh = PowerTable.rows[cur_row].cells[0].innerText;
	window.location.href = "mPatent.action?method=showPatent&ID="+nbbh;
}
function exportThem(){
	<%
	String s = (String) request.getAttribute("s");
	if(s!=null)
		out.println("var s = '&s=' + encodeURI(encodeURI(\""+s+"\"));");
	else
		out.println("var s = '';");
	%>
	window.open("mPatent.action?method=exportToExcel<%=year!=null?"&year="+year:"" %>" + s);
}


	
	<%StringBuffer sb = new StringBuffer("var contents = new Array(");
	  String tempstr;
		if(list!=null&&list.size()!=0){
				for (Patent pt : list) {
					for(FieldBean fb : fList) {
						tempstr=FieldsControl.doVoGetMethod(pt, fb.getCode());
				        String dest = "";  
				        if (tempstr!=null) {  
				        	dest=tempstr.trim();                                                        //去掉空格
				        	if(dest.contains("\'")){                                                   //contains 包含，依次比较
				        		
				        		dest=dest.replace("\'","\\\'");
				        		}
				        	sb.append("'" + dest + "',");                                          //append添加，追加
				        }
				        else
				        	sb.append("'" + FieldsControl.doVoGetMethod(pt, fb.getCode()) + "',");
					}
				}
				out.println(sb.substring(0, sb.length() - 1) + ");");
				out.println("var pSize = " + list.size() + ";");
				%>var allSize = contents.length/pSize;<%
		}else{
			out.println(sb + ");");
			out.println("var pSize = 0;");
			%>var allSize = 0;<%
		}
		%>

    function apply(number){
        // flag值的意义：1表示查询申请成功的专利  2表示未成功申请的专利
		var flag=number;
        window.open("mPatent.action?method=apply&year=all&flag="+flag,"ManagePatents");
	}
</script>
<body>
<div id="cover" class="showTheControl"></div>
<div id="search">
<%@ include file="searchPatent.jsp" %>
</div>
<div id="control">
<form method="post" name="ShowCon" action="mProject.action?method=setProjectDisplay">
<table align="left" border="0" style="margin:0px;padding:0px" width="200px">
	<tr>
		<th class="head">设置可显示字段</th>
	</tr>
	<tr>
		<td>
		<ul id="ids">
		<%
			int fSize = fList.size();
			for(int n=0;n<fSize;n++){ 
				FieldBean ifb = fList.get(n);
		%>
			<li onclick = "clickLi(this);" onmouseover="this.style.color='gray';" onmouseout="this.style.color='black';"><input type="checkbox" value="<%=n %>"<%=ifb.getDisplay()?" checked":"" %> name="sfield"/><%=ifb.getName() %></li>
		<%	} %>
		</ul>
		</td>
	</tr>
	<tr>
		<td>
			<input style="margin-left:10px;border:1px solid blue" type="button" onclick="checkAll();" value="全选"/>
			<font class="save_style" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';" size="3" title="请注意，保存设置将对所有用户生效！"><input type="checkbox" name="save"/>保存设置</font>
		</td>
	</tr>
	<tr>
		<td style="text-align:center">
			<input style="margin-top:8px" type="button" onclick="reBuildTable('Patent');" value="确定" />
			<input style="margin-left:20px" type="button" onclick="hide('control');" value="取消" />
		</td>
	</tr>
</table>
</form>
</div>
<table class="manage" style="margin: 5px;" border="1" cellpadding="0" cellspacing="0" width="99%">
	<tr>
		<th colspan="4" class="head">专利项目管理</th>
	</tr>
	<tr>
		<td>
		<input type="button" value="授权专利" onclick="apply('1')" />
		<input type="button" value="申请专利" onclick="apply('2')" />
		<input type="button" value="申报专利项目" onclick="window.open('page/patent/addPatent.jsp','ManagePatents');" />
		<input type="button" value="查看专利项目" onclick="showIt();" />
		<input type="button" value="编辑专利项目" onclick="updateIt();" />
		<input type="button" value="删除专利项目" onclick="deleteIt();" />
		<input type="button" value="控制" onclick="setCols('control');" />
		<input type="button" value="检索" onclick="setCols('search');" />
		<input type="button" value="输出" onclick="exportThem();" />
		</td>
	</tr>
</table>

<!-- <div id="projects">
<table id="PowerTable" class="projects" border="1" cellpadding="0" cellspacing="0">
	<tr id="TableHead" style="font-weight: bold;"></tr>
</table>
</div>
 -->
<!-- 显示分页 -->
<div id="pageDiv">共有记录：<%=resultCount%>条&nbsp;&nbsp;&nbsp; <%
 	if (pageCount > 0) {
 %> <a href="<%=pagiUrl%>&page=1&year=<%=(year==null)?"all":year %>" onclick="encodePagiUrl(this);">首页</a>|
<%
 	} else {
 %> 首页| <%
 	}

 	if (currentPage > 1) {
 %> <a href="<%=pagiUrl%>&page=<%=currentPage - 1%>&year=<%=(year==null)?"all":year %>"
	onclick="encodePagiUrl(this);">上一页</a>| <%
 	} else {
 %> 上一页| <%
 	}

 	int first = 0;
 	int last = 0;
 	if (pageCount <= 10) {
 		first = 1;
 		last = pageCount;
 	} else {
 		if (currentPage - 5 <= 0) {
 			first = 1;
 			last = 10;
 		} else if (pageCount - currentPage <= 5) {
 			last = pageCount;
 			first = last - 9;

 		} else {
 			first = currentPage - 4;
 			last = first + 9;
 		}
 	}

 	for (int i = first; i <= last; i++) {
 		if (i == currentPage) {
 %><span style="background-color: #5F5F5F; width: 15px"> <a
	href="<%=pagiUrl%>&page=<%=i%>&year=<%=(year==null)?"all":year %>" onclick="encodePagiUrl(this);"><%=i%></a>
</span>| <%
	} else {
%> <a href="<%=pagiUrl%>&page=<%=i%>&year=<%=(year==null)?"all":year %>" onclick="encodePagiUrl(this);"><%=i%></a>|
<%
 	}
 	}

 	if (currentPage < pageCount) {
 %> <a href="<%=pagiUrl%>&page=<%=currentPage + 1%>&year=<%=(year==null)?"all":year %>"
	onclick="encodePagiUrl(this);">下一页</a>| <%
 	} else {
 %> 下一页| <%
 	}

 	if (pageCount > 0) {
 %> <a href="<%=pagiUrl%>&page=<%=pageCount%>&year=<%=(year==null)?"all":year %>"
	onclick="encodePagiUrl(this);">尾页</a> <%
 	} else {
 %> 尾页| <%
 	}
 %>
</div>
</body>
</html>