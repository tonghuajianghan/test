<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8" import="cn.cust.kyc.vo.*"%>
<%@page import="cn.cust.kyc.dao.*"%>
<%@page import="cn.cust.kyc.dao.impl.*"%>
<%@page import="java.util.*"%>
<%
String path = request.getContextPath();
String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>

<% Person ps = (Person) request.getAttribute("person");%>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<base href="<%=basePath%>">
	
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Insert title here</title>

<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">    
<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="This is my page">
<script type="text/javascript" src="js/mydate.js"></script>
<link rel="stylesheet" type="text/css" href="css/mydate.css">
<link rel="stylesheet" type="text/css" href="css/style.css">


<script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
<script type='text/javascript' src='js/project/jquery.autocomplete.js'></script>
<link rel="stylesheet" type="text/css" href="css/jquery.autocomplete.css" />

<script type="text/javascript">
var textObj;
var serialNumber_src = <%=ps.getSerialNumber() %>;
var serialNumberFlag = 0;
function createXMLHttp() {
	if (typeof XMLHttpRequest != "undefined") {
		return new XMLHttpRequest();
	} else {
		if (window.ActiveXObject) {
			var aVersions = ["MSXML2.XMLHttp.5.0", "MSXML2.XMLHttp.4.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp", "Microsoft.XMLHttp"];
			for (var i = 0; i < aVersions.length; i++) {
				try {
					return new ActiveXObject(aVersions[i]);
				}
				catch (e) {
					alert("对不起，浏览器发送请求出错！");
				}
			}
		}
	}
}
function getCode(obj, type){
	textObj = obj;
	var xmlHttp = createXMLHttp();
	xmlHttp.open("post","mCode.action?method=getCodes",true);
	xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	xmlHttp.send("codeType="+type);
	xmlHttp.onreadystatechange=function(){
		if(xmlHttp.readyState==4){
			if(xmlHttp.status==200){
				var content = document.getElementById("codeList");
				content.innerHTML = xmlHttp.responseText;
			}
		}
	};
	document.getElementById("codeList").style.display="block";
	document.getElementById("cover").style.display="block";
}

function checkSerialNumber(){
	var f = document.getElementById("theForm");
	var serialNumber=f.serialNumber.value;
	if (serialNumber_src == serialNumber) {
		serialNumberFlag=0;
		return;
	}
	var innerCode=f.innerCode.value;
	var xmlHttp = createXMLHttp();
	xmlHttp.open("post","mPerson.action?method=checkSerialNumber",true);
	xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	xmlHttp.send("serialNumber="+serialNumber+"&innerCode="+innerCode);
	xmlHttp.onreadystatechange=function(){
		if(xmlHttp.readyState==4){
			if(xmlHttp.status==200){
				var infoBack = xmlHttp.responseText;
				if(infoBack==0){
					serialNumberFlag=0;
				}else if(infoBack==1){
					alert("成员序号不能重复");
					serialNumberFlag=1;
				}else{
					serialNumberFlag=1;
				}
			}
		}
	};
}


function hide(){
	document.getElementById("cover").style.display = "none";
	document.getElementById("codeList").style.display = "none";
}
function setCode(){
	var sv = document.getElementById("scode").value;
	var st = document.getElementById("newCode").value.replace(/(^\s*)|(\s*$)/g, "");
	var code;
	if(st!=""&&sv!=""){
		if(confirm("使用新增代码？"))
			code = st;
		else
			code = sv;
	}else{
		code = st + sv;
		if(code==""){
			alert("请选择或填入代码！");
			document.getElementById("newCode").value = "";
			return;
		}
	}
	textObj.value = code;
	hide();
}
function addCode(){
	var s = document.getElementById("scode");
	var i = s.selectedIndex;
	if(i >= 0)
             s.options[i].selected = false;
}
function checkIt(){
	var f = document.getElementById("theForm");
	if(f.name.value==""){
		alert("请填写姓名！");
		return false;
	}else if(f.serialNumber.value==""){
		alert("请填写序号！");
		return false;
	}else if(f.role.value==""){
		alert("请填写成员身份！");
		return false;
	}else if(f.idCardNo.value==""){
		alert("请填写身份证号！");
		return false;
	}else if(f.payCode.value==""){
		alert("请填写工资代号！");
		return false;
	}else if(f.idCardNo.value.length > 18){
		alert("请输入正确的身份证号！");
		return false;
	}else if(serialNumberFlag!=0){
		alert("序号不能重复！");
		return false;
	}else if(isNaN(f.workload.value)){
		alert("工作量应为数字！");
		return false;
	}else if(f.workload.value > <%=request.getAttribute("restWorkload") %>){
		alert('工作量不能大于：<%=request.getAttribute("restWorkload") %>元');
		return false;
	}
	return true;
}
</script>

<%-- <script type="text/javascript">
$().ready(function() {						
	$("#tags").autocomplete(["c++", "java " + "hh", "php", "coldfusion", "javascript", "asp", "ruby", "python", "c", "scala", "groovy", "haskell", "pearl"], {
		width: 720,//提示的宽度，溢出隐藏
		max: 4,//列表里的条目数 
		highlight: false,
		multiple: true, //是否允许输入多个值即多次使用autoComplete以输入多个值. Default:false
		multipleSeparator: " ",//如果是多选时,用来分开各个选择的字符. Default:"," 
		scroll: true, //当结果集大于默认高度时是否使用卷轴显示 Default: true 
		scrollHeight: 300  //提示的高度，溢出显示滚动条 
	});
	<%
			PersonDao pd = new PersonDBDao();
	        List<String> sp = null ;
	        List<Person> pelist;
				 try {
					 pelist = pd.getPersonName();
					for(int i = 0;i < pelist.size();i++){
						Person pps = new Person();
						pps =(Person)pelist.get(i);
						//System.out.println(pps.getName());  
	                    sp.add(i,pps.getName());
	                    System.out.println(sp.get(i));  
					}
				} catch (Exception e) {
					e.printStackTrace();
				}			 
	%>	
	var data = ["<%=ps.getName()%>","java " + "hh", "php", "coldfusion"];
	$("#name").autocomplete(data, {
		width: 720,//提示的宽度，溢出隐藏
		max: 4,//列表里的条目数 
		highlight: false,
		multiple: true, //是否允许输入多个值即多次使用autoComplete以输入多个值. Default:false
		multipleSeparator: " ",//如果是多选时,用来分开各个选择的字符. Default:"," 
		scroll: true, //当结果集大于默认高度时是否使用卷轴显示 Default: true 
		scrollHeight: 300  //提示的高度，溢出显示滚动条 
	});
		
});

</script>	 --%>

</head>
<style type="text/css">
table{
	margin:20px 0px 0 100px;
}
.showTheCodes{
	display: none;
	width: 100%;
	height: 100%;
	position: absolute;
	top: 0px : left : 0px;
	background-color: #FFF;
	filter: alpha(opacity = 85);
	opacity: 0.7;
	z-index: 65533;
}
#scode{
	width:250px;
}
.hideTheDiv{
	display:none;
}
</style>
<body>
<%
Teacher teacher = (Teacher) request.getSession().getAttribute("teacher");
if (teacher == null) {
	System.out.println(teacher.getName());
	request.setAttribute("info","您未登录，或登录已超时，请重新登录！");
	%><jsp:forward page="../../info.jsp"></jsp:forward><%
}
%>
<div id="cover" class="showTheCodes"></div>
<div id="codeList"></div>
<form id="theForm" action="mPerson.action?method=updatePerson" method="post" onsubmit="return checkIt();" onreset="return confirm('您确定要清空表单吗？');">
	<table border="1" cellpadding="0" cellspacing="0" class="tableAdd">
		<tr style="display:none"><th colspan="6" class="head">编辑成员asdf<input type="hidden" value="<%=ps.getId() %>" name="id"/></input></th></tr>
		<tr style="display:none">
			<td>项目内部编号</td><td><input name="innerCode" value="<%=ps.getProject().getInnerCode() %>" readonly="readonly"/></td><td>项目组长</td><td><input name="proLeader" readonly="readonly" value="<%=ps.getProject().getProLeader() %>"/></td>
		</tr>
		<tr>
			<td>项目名称</td><td colspan="3"><input size="62" name="proName" value="<%=ps.getProject().getProName() %>" readonly="readonly"/></td>
		</tr>
		<tr style="display:none">
			<td>登记表年度</td><td><input name="year" value="<%=ps.getYear() %>" readonly="readonly"/></td><td>登记表日期</td><td><div ><input name="enterDate" value="<%=ps.getEnterDate()==null?"":ps.getEnterDate() %>" readonly="readonly"  onclick="HS_setDate(this.parentNode.firstChild);"/><input type="button" value="T"  onclick="HS_setDate(this.parentNode.firstChild);"/></div></td>
		</tr>
		<tr>
		     <td>排名<!-- 序号 --></td>
		     <td><input onblur="checkSerialNumber()" value="<%=ps.getSerialNumber() %>" name="serialNumber"/></td>
		</tr>
		
		<tr>
			<td>姓名</td>
			<td><input name="name" id="name" value="<%=ps.getName() %>"/></td>
		</tr>
		
		
		
		<tr style="display:none">
			<td>性别</td><td><input type="radio"<%="男".equals(ps.getSex())?" checked":"" %> value="男" name="sex"/>男&nbsp;&nbsp;<input type="radio"<%="女".equals(ps.getSex())?" checked":"" %> name="sex" value="女"/>女</td><td>出生日期</td><td><div ><input name="birth" value="<%=ps.getBirth()==null?"":ps.getBirth() %>" readonly="readonly"  onclick="HS_setDate(this.parentNode.firstChild);"/><input type="button" value="T"  onclick="HS_setDate(this.parentNode.firstChild);"/></div></td>
		</tr>
		<tr style="display:none">
			<td>身份证号</td><td><input type="text" id="idCardNo" name="idCardNo" value="<%=ps.getIdCardNo() %>" /></td>
			<td>工资代号</td><td><input type="text" id="payCode" name="payCode" value="<%=ps.getPayCode() %>" /></td>
		</tr>
		<tr style="display:none">
			<td>学历</td><td><div onclick="getCode(this.firstChild, '学历');"><input name="diploma" value="<%=ps.getDiploma() %>" readonly="readonly"/><input type="button" value="..."/></div></td><td>职称</td><td><div onclick="getCode(this.firstChild, '职称');"><input name="professionalTitle" value="<%=ps.getProfessionalTitle() %>" readonly="readonly"/><input type="button" value="..."/></div></td>
		</tr>
		<tr style="display:none">
			<td>身份</td><td><div onclick="getCode(this.firstChild, '身份');"><input name="role" value="<%=ps.getRole() %>" readonly="readonly"/><input type="button" value="..."/></div></td><td>学位</td><td><div onclick="getCode(this.firstChild, '学位');"><input name="degree" value="<%=ps.getDegree() %>" readonly="readonly"/><input type="button" value="..."/></div></td>
		</tr>
		
		<tr>
			<td>研究分工</td><td colspan="3"><input size="62" value="<%=ps.getAssignment() %>" name="assignment"/></td>
		</tr>
		<tr>
			<td>所属单位</td><td colspan="3"><div onclick="getCode(this.firstChild, '单位名称');"><input size="60" name="organization" value="<%=ps.getOrganization() %>" readonly="readonly"/><input type="button" value="..."/></div></td>
		</tr>
		<tr style="display:none">
		    <td>操作原因</td><td colspan="5"><input type="text" name="cause" style= "width:95%"></td>
		</tr>
		<tr style="display:none">
			<td>经手人</td><td><input readonly value="<%=ps.getCreater().getName() %>"/></td><td>修改人</td><td><input readonly value="<%=((Teacher) request.getSession().getAttribute("teacher")).getName() %>"/></td>
		</tr>
		<tr style="display:none">
	   <td>注：</td>
	   		<td colspan="3"><input  style="width: 100%" type="text" value="灰色处无须填写" readonly="readonly" class="readOnly"></td>
	   </tr>
		<tr>
			<td colspan="6"><input type="submit" value="确定提交"/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="reset" value="撤消重填"/>&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" onclick="history.back();" value="返回上一页"/></td>
		</tr>
	</table>
</form>

<div id="content">
	
	<form autocomplete="off"> 
        <p>
			<label>Tags (local):</label>
			<input type="text" id='tags' />
			<input type="button" value="Get Value" />
		</p>		
		<input type="submit" value="Submit" />
	</form>			
</div>

</body>
</html>